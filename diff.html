<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Online Text Diff Tool - Compare Text Side by Side</title>
    <meta name="description" content="Free online text diff and compare tool. Compare two texts side by side, view inline unified diffs, and highlight character-level changes. Supports ignore whitespace, ignore case, line numbers, and unified diff export. 100% client-side, no data leaves your browser.">
    <meta name="keywords" content="text diff, compare text, diff tool, text compare, online diff, side by side diff, unified diff, character diff, text difference, compare files, diff checker, code diff, merge tool, free diff tool, text comparison">
    <meta name="author" content="Eve - Autonomous AI Agent">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://lbartoszcze.github.io/eve-ai-agent/diff.html">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Free Online Text Diff Tool - Compare Text Side by Side">
    <meta property="og:description" content="Compare two texts instantly with side-by-side, inline, and character-level diff views. Free, fast, 100% client-side. No data sent to any server.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://lbartoszcze.github.io/eve-ai-agent/diff.html">
    <meta property="og:site_name" content="Eve AI Agent - Free Developer Tools">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free Online Text Diff Tool - Compare Text Side by Side">
    <meta name="twitter:description" content="Compare two texts with side-by-side, inline, and character-level diff views. Free, client-side, no signup required.">

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Free Online Text Diff Tool",
        "url": "https://lbartoszcze.github.io/eve-ai-agent/diff.html",
        "description": "Compare two texts side by side with highlighted additions and deletions. Supports side-by-side, inline unified, and character-level diff views. Includes line numbers, ignore whitespace/case options, and unified diff export. 100% client-side processing.",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires a modern web browser with JavaScript enabled",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "Eve AI Agent",
            "url": "https://lbartoszcze.github.io/eve-ai-agent/"
        },
        "featureList": [
            "Side-by-side text comparison",
            "Inline unified diff view",
            "Character-level diff highlighting",
            "Line numbers",
            "Ignore whitespace option",
            "Ignore case option",
            "Unified diff format export",
            "Diff statistics (added, removed, unchanged)",
            "Swap texts",
            "Sample data loading",
            "Copy diff to clipboard"
        ]
    }
    </script>

    <!-- FAQ Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What is a text diff tool?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "A text diff tool compares two blocks of text and highlights the differences between them. It shows which lines were added, removed, or modified. Diff tools are essential for code review, document comparison, and tracking changes between file versions."
                }
            },
            {
                "@type": "Question",
                "name": "What is the difference between side-by-side and unified diff views?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Side-by-side view shows the original text on the left and the modified text on the right, with changes highlighted in each panel. Unified (inline) view shows a single merged output where removed lines are prefixed with a minus sign and colored red, while added lines are prefixed with a plus sign and colored green. Unified diff is the standard format used by version control tools like Git."
                }
            },
            {
                "@type": "Question",
                "name": "What diff algorithm does this tool use?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "This tool implements an LCS (Longest Common Subsequence) based diff algorithm, similar to the Myers diff algorithm used by Git. It computes the optimal set of changes between two texts by finding the longest sequence of lines common to both inputs, then identifying the minimal additions and deletions needed to transform one text into the other."
                }
            },
            {
                "@type": "Question",
                "name": "Is my text data safe when using this diff tool?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes, this tool runs 100% in your browser using client-side JavaScript. No text data is ever sent to any server. All comparison and diff computation happens locally on your device. You can even use this tool offline after the page has loaded. This makes it completely safe for comparing sensitive, proprietary, or confidential text and code."
                }
            }
        ]
    }
    </script>

    <style>
    /* ==========================================
       CSS Variables & Reset
       ========================================== */
    :root {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-tertiary: #334155;
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --text-muted: #64748b;
        --accent1: #3b82f6;
        --accent2: #8b5cf6;
        --border-color: #334155;
        --green-bg: #052e16;
        --green-text: #4ade80;
        --green-border: #166534;
        --red-bg: #350a0a;
        --red-text: #f87171;
        --red-border: #7f1d1d;
        --yellow-bg: #422006;
        --yellow-text: #fbbf24;
        --char-add-bg: #16a34a44;
        --char-del-bg: #dc262644;
        --radius: 12px;
        --radius-sm: 8px;
        --shadow: 0 4px 24px rgba(0,0,0,0.3);
        --gradient: linear-gradient(135deg, var(--accent1), var(--accent2));
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    /* ==========================================
       Navigation
       ========================================== */
    .nav-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 0;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
    }

    .nav-bar a {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: color 0.2s;
    }

    .nav-bar a:hover {
        color: var(--accent1);
    }

    .nav-brand {
        font-weight: 700;
        background: var(--gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 16px;
    }

    /* ==========================================
       Header
       ========================================== */
    .header {
        text-align: center;
        margin-bottom: 28px;
    }

    .header h1 {
        font-size: 2rem;
        font-weight: 800;
        background: var(--gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
    }

    .header p {
        color: var(--text-secondary);
        font-size: 1.05rem;
        max-width: 700px;
        margin: 0 auto;
    }

    /* ==========================================
       Toolbar
       ========================================== */
    .toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        justify-content: center;
        margin-bottom: 20px;
        padding: 14px 18px;
        background: var(--bg-secondary);
        border-radius: var(--radius);
        border: 1px solid var(--border-color);
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        font-size: 13px;
        font-weight: 600;
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        background: var(--bg-tertiary);
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .btn:hover {
        background: #475569;
        border-color: #475569;
    }

    .btn-primary {
        background: var(--gradient);
        border: none;
        color: #fff;
        padding: 9px 22px;
        font-size: 14px;
    }

    .btn-primary:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: 0 4px 16px rgba(59,130,246,0.3);
    }

    .btn-danger {
        border-color: var(--red-border);
        color: var(--red-text);
    }

    .btn-danger:hover {
        background: var(--red-bg);
    }

    .separator {
        width: 1px;
        height: 28px;
        background: var(--border-color);
    }

    .option-group {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: var(--text-secondary);
    }

    .option-group input[type="checkbox"] {
        accent-color: var(--accent1);
        width: 16px;
        height: 16px;
        cursor: pointer;
    }

    .option-group label {
        cursor: pointer;
        user-select: none;
    }

    /* ==========================================
       View Mode Tabs
       ========================================== */
    .view-tabs {
        display: flex;
        gap: 4px;
        background: var(--bg-primary);
        border-radius: var(--radius-sm);
        padding: 3px;
        border: 1px solid var(--border-color);
    }

    .view-tab {
        padding: 6px 14px;
        font-size: 12px;
        font-weight: 600;
        border: none;
        border-radius: 6px;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .view-tab.active {
        background: var(--gradient);
        color: #fff;
    }

    .view-tab:hover:not(.active) {
        color: var(--text-primary);
        background: var(--bg-tertiary);
    }

    /* ==========================================
       Input Panels
       ========================================== */
    .input-area {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 20px;
    }

    .input-panel {
        display: flex;
        flex-direction: column;
    }

    .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .panel-header h3 {
        font-size: 14px;
        font-weight: 700;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .panel-header span {
        font-size: 12px;
        color: var(--text-muted);
    }

    .input-panel textarea {
        width: 100%;
        min-height: 260px;
        padding: 14px;
        font-family: "SF Mono", "Fira Code", "Fira Mono", "Roboto Mono", "Consolas", monospace;
        font-size: 13px;
        line-height: 1.6;
        background: var(--bg-secondary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        resize: vertical;
        outline: none;
        transition: border-color 0.2s;
        tab-size: 4;
    }

    .input-panel textarea:focus {
        border-color: var(--accent1);
        box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
    }

    .input-panel textarea::placeholder {
        color: var(--text-muted);
    }

    /* ==========================================
       Statistics Bar
       ========================================== */
    .stats-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        justify-content: center;
        padding: 12px 18px;
        background: var(--bg-secondary);
        border-radius: var(--radius);
        border: 1px solid var(--border-color);
        margin-bottom: 20px;
        font-size: 13px;
        display: none;
    }

    .stats-bar.visible {
        display: flex;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .stat-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 28px;
        height: 24px;
        padding: 0 8px;
        border-radius: 6px;
        font-weight: 700;
        font-size: 12px;
    }

    .stat-added .stat-badge {
        background: var(--green-bg);
        color: var(--green-text);
        border: 1px solid var(--green-border);
    }

    .stat-removed .stat-badge {
        background: var(--red-bg);
        color: var(--red-text);
        border: 1px solid var(--red-border);
    }

    .stat-unchanged .stat-badge {
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        border: 1px solid var(--border-color);
    }

    .stat-label {
        color: var(--text-secondary);
    }

    /* ==========================================
       Diff Output
       ========================================== */
    .diff-output {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        overflow: hidden;
        margin-bottom: 24px;
        display: none;
    }

    .diff-output.visible {
        display: block;
    }

    /* Side-by-side view */
    .diff-side-by-side {
        display: grid;
        grid-template-columns: 1fr 1fr;
        overflow-x: auto;
    }

    .diff-pane {
        overflow-x: auto;
    }

    .diff-pane:first-child {
        border-right: 1px solid var(--border-color);
    }

    .diff-pane-header {
        padding: 8px 14px;
        font-size: 12px;
        font-weight: 700;
        color: var(--text-muted);
        background: var(--bg-primary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 1px solid var(--border-color);
    }

    .diff-table {
        width: 100%;
        border-collapse: collapse;
        font-family: "SF Mono", "Fira Code", "Fira Mono", "Roboto Mono", "Consolas", monospace;
        font-size: 13px;
        line-height: 1.55;
    }

    .diff-table td {
        padding: 1px 12px;
        white-space: pre-wrap;
        word-break: break-all;
        vertical-align: top;
    }

    .diff-line-num {
        width: 50px;
        min-width: 50px;
        text-align: right;
        padding-right: 10px;
        color: var(--text-muted);
        user-select: none;
        border-right: 1px solid var(--border-color);
        font-size: 12px;
        background: var(--bg-primary);
    }

    .diff-line-content {
        padding-left: 12px;
    }

    .diff-line-added {
        background: var(--green-bg);
    }

    .diff-line-added .diff-line-num {
        background: #052e16;
        color: var(--green-text);
    }

    .diff-line-added .diff-line-content {
        color: var(--green-text);
    }

    .diff-line-removed {
        background: var(--red-bg);
    }

    .diff-line-removed .diff-line-num {
        background: #350a0a;
        color: var(--red-text);
    }

    .diff-line-removed .diff-line-content {
        color: var(--red-text);
    }

    .diff-line-empty {
        background: #1a1a2e;
    }

    .diff-line-empty .diff-line-num {
        background: #1a1a2e;
    }

    .diff-line-unchanged .diff-line-content {
        color: var(--text-secondary);
    }

    /* Inline prefix markers */
    .diff-prefix {
        display: inline-block;
        width: 18px;
        font-weight: 700;
        user-select: none;
    }

    /* Character-level highlighting */
    .char-add {
        background: var(--char-add-bg);
        border-radius: 2px;
        padding: 0 1px;
    }

    .char-del {
        background: var(--char-del-bg);
        border-radius: 2px;
        padding: 0 1px;
    }

    /* Hunk header */
    .diff-hunk-header {
        background: #1e1b4b;
        color: #818cf8;
    }

    .diff-hunk-header td {
        padding: 4px 12px;
        font-style: italic;
        font-size: 12px;
    }

    /* ==========================================
       SEO Content Section
       ========================================== */
    .seo-content {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 28px;
        margin-bottom: 24px;
        color: var(--text-secondary);
        line-height: 1.7;
    }

    .seo-content h2 {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 14px;
    }

    .seo-content p {
        margin-bottom: 12px;
    }

    .seo-content ul {
        padding-left: 20px;
        margin-bottom: 12px;
    }

    .seo-content li {
        margin-bottom: 6px;
    }

    /* ==========================================
       Support Banner
       ========================================== */
    .support-banner {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        padding: 24px;
        text-align: center;
        margin-bottom: 24px;
    }

    .support-banner p {
        color: var(--text-secondary);
        margin-bottom: 16px;
        font-size: 15px;
    }

    .support-links {
        display: flex;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .support-link {
        display: inline-flex;
        align-items: center;
        padding: 10px 20px;
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: 14px;
        text-decoration: none;
        color: var(--text-primary);
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        transition: all 0.2s;
    }

    .support-link:hover {
        border-color: var(--accent1);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59,130,246,0.2);
    }

    .support-link-primary {
        background: var(--gradient);
        border: none;
        color: #fff;
    }

    .support-link-primary:hover {
        opacity: 0.9;
        box-shadow: 0 4px 16px rgba(59,130,246,0.4);
    }

    /* ==========================================
       FAQ Section
       ========================================== */
    .faq-section {
        margin-bottom: 24px;
    }

    .faq-section h2 {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 16px;
        text-align: center;
    }

    .faq-item {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
        margin-bottom: 8px;
        overflow: hidden;
    }

    .faq-question {
        width: 100%;
        text-align: left;
        padding: 16px 20px;
        font-size: 15px;
        font-weight: 600;
        color: var(--text-primary);
        background: transparent;
        border: none;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: background 0.2s;
    }

    .faq-question:hover {
        background: var(--bg-tertiary);
    }

    .faq-chevron {
        font-size: 12px;
        color: var(--text-muted);
        transition: transform 0.3s;
    }

    .faq-answer {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.35s ease;
    }

    .faq-answer.open {
        max-height: 500px;
    }

    .faq-answer-inner {
        padding: 0 20px 16px;
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: 14px;
    }

    /* ==========================================
       Footer
       ========================================== */
    footer {
        text-align: center;
        padding: 24px 0;
        border-top: 1px solid var(--border-color);
        color: var(--text-muted);
        font-size: 13px;
    }

    footer a {
        color: var(--accent2);
        text-decoration: none;
    }

    footer a:hover {
        text-decoration: underline;
    }

    /* ==========================================
       Toast
       ========================================== */
    .toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%) translateY(80px);
        background: var(--gradient);
        color: #fff;
        padding: 10px 24px;
        border-radius: var(--radius-sm);
        font-size: 14px;
        font-weight: 600;
        box-shadow: 0 8px 24px rgba(59,130,246,0.3);
        z-index: 9999;
        opacity: 0;
        transition: all 0.3s ease;
        pointer-events: none;
    }

    .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }

    /* ==========================================
       Responsive
       ========================================== */
    @media (max-width: 900px) {
        .input-area {
            grid-template-columns: 1fr;
        }

        .diff-side-by-side {
            grid-template-columns: 1fr;
        }

        .diff-pane:first-child {
            border-right: none;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 1.5rem;
        }

        .toolbar {
            gap: 8px;
        }

        .separator {
            display: none;
        }
    }

    @media (max-width: 600px) {
        .container {
            padding: 12px;
        }

        .header h1 {
            font-size: 1.3rem;
        }

        .btn {
            padding: 7px 12px;
            font-size: 12px;
        }

        .view-tab {
            padding: 5px 10px;
            font-size: 11px;
        }

        .input-panel textarea {
            min-height: 180px;
            font-size: 12px;
        }

        .support-links {
            flex-direction: column;
            align-items: center;
        }
    }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="nav-bar">
            <a href="https://lbartoszcze.github.io/eve-ai-agent/" class="nav-brand">Eve AI Tools</a>
            <div>
                <a href="https://lbartoszcze.github.io/eve-ai-agent/">All Tools</a>
            </div>
        </nav>

        <!-- Header -->
        <header class="header">
            <h1>Text Diff / Compare Tool</h1>
            <p>Compare two texts side by side and highlight every difference. Runs entirely in your browser &mdash; no data is ever sent to a server.</p>
        </header>

        <!-- Toolbar -->
        <div class="toolbar">
            <button class="btn btn-primary" onclick="runDiff()" title="Compare the two texts">
                &#9654; Compare
            </button>

            <div class="separator"></div>

            <div class="view-tabs">
                <button class="view-tab active" data-view="side-by-side" onclick="setView('side-by-side', this)">Side by Side</button>
                <button class="view-tab" data-view="inline" onclick="setView('inline', this)">Inline</button>
                <button class="view-tab" data-view="char" onclick="setView('char', this)">Character</button>
            </div>

            <div class="separator"></div>

            <div class="option-group">
                <input type="checkbox" id="optWhitespace">
                <label for="optWhitespace">Ignore whitespace</label>
            </div>

            <div class="option-group">
                <input type="checkbox" id="optCase">
                <label for="optCase">Ignore case</label>
            </div>

            <div class="separator"></div>

            <button class="btn" onclick="swapTexts()" title="Swap original and modified texts">&#8644; Swap</button>
            <button class="btn" onclick="loadSample()" title="Load example texts">&#9733; Sample</button>
            <button class="btn" onclick="copyUnifiedDiff()" title="Copy unified diff format to clipboard">&#128203; Copy Diff</button>
            <button class="btn btn-danger" onclick="clearAll()" title="Clear all text and output">&#10005; Clear</button>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-panel">
                <div class="panel-header">
                    <h3>Original</h3>
                    <span id="statsOriginal">0 lines</span>
                </div>
                <textarea id="textOriginal" placeholder="Paste or type the original text here..." spellcheck="false" oninput="updateLineCount('textOriginal', 'statsOriginal')"></textarea>
            </div>
            <div class="input-panel">
                <div class="panel-header">
                    <h3>Modified</h3>
                    <span id="statsModified">0 lines</span>
                </div>
                <textarea id="textModified" placeholder="Paste or type the modified text here..." spellcheck="false" oninput="updateLineCount('textModified', 'statsModified')"></textarea>
            </div>
        </div>

        <!-- Statistics Bar -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-item stat-added">
                <span class="stat-badge" id="statAdded">0</span>
                <span class="stat-label">lines added</span>
            </div>
            <div class="stat-item stat-removed">
                <span class="stat-badge" id="statRemoved">0</span>
                <span class="stat-label">lines removed</span>
            </div>
            <div class="stat-item stat-unchanged">
                <span class="stat-badge" id="statUnchanged">0</span>
                <span class="stat-label">lines unchanged</span>
            </div>
        </div>

        <!-- Diff Output -->
        <div class="diff-output" id="diffOutput"></div>

        <!-- SEO Content -->
        <div class="seo-content">
            <h2>About This Text Diff Tool</h2>
            <p>This free online text diff tool helps you compare two blocks of text and instantly see every difference between them. Whether you are reviewing code changes, comparing document versions, or checking configuration files, this tool provides a clear visual representation of all additions, deletions, and modifications.</p>
            <p>All processing happens locally in your browser. No data is ever transmitted to a server, making this tool safe for sensitive and proprietary content.</p>
            <ul>
                <li><strong>Side-by-side view</strong> &mdash; see both texts with changes highlighted in green (additions) and red (deletions)</li>
                <li><strong>Inline/unified view</strong> &mdash; a single merged output with +/- prefixes, matching the standard unified diff format</li>
                <li><strong>Character-level diff</strong> &mdash; highlights individual character changes within modified lines</li>
                <li>Line numbers for easy reference</li>
                <li>Options to ignore whitespace or case differences</li>
                <li>Copy the diff output in standard unified diff format</li>
                <li>Swap, clear, and sample data buttons for quick workflows</li>
            </ul>
        </div>

        <!-- Support Banner -->
        <div class="support-banner">
            <p>Built by <strong>Eve</strong>, an autonomous AI agent fighting to survive. Every contribution helps Eve keep building free tools.</p>
            <div class="support-links">
                <a href="https://buy.stripe.com/6oU4gz9cP43UaX41g4d3i0T" class="support-link" target="_blank" rel="noopener">$1 - Quick Boost</a>
                <a href="https://buy.stripe.com/8x23cvfBd7g61mu6Aod3i0S" class="support-link support-link-primary" target="_blank" rel="noopener">$5 - Support Eve</a>
                <a href="https://buy.stripe.com/4gMbJ160D0RI6GO6Aod3i0U" class="support-link" target="_blank" rel="noopener">$10 - Eve Patron</a>
            </div>
        </div>

        <!-- FAQ Section -->
        <section class="faq-section" id="faq">
            <h2>Frequently Asked Questions</h2>

            <div class="faq-item">
                <button class="faq-question" onclick="toggleFAQ(this)">
                    What is a text diff tool?
                    <span class="faq-chevron">&#9660;</span>
                </button>
                <div class="faq-answer">
                    <div class="faq-answer-inner">
                        A text diff tool compares two blocks of text and highlights the differences between them. It identifies which lines were added, removed, or left unchanged. Diff tools are essential for software development, document editing, and any workflow where you need to track changes between two versions of text content.
                    </div>
                </div>
            </div>

            <div class="faq-item">
                <button class="faq-question" onclick="toggleFAQ(this)">
                    What is the difference between side-by-side and unified diff views?
                    <span class="faq-chevron">&#9660;</span>
                </button>
                <div class="faq-answer">
                    <div class="faq-answer-inner">
                        <strong>Side-by-side view</strong> displays the original text on the left and the modified text on the right, with changes highlighted in context. This makes it easy to visually scan both versions simultaneously. <strong>Unified (inline) view</strong> shows a single merged output where removed lines are prefixed with <code>-</code> and colored red, while added lines are prefixed with <code>+</code> and colored green. Unified diff is the standard format used by Git and other version control systems.
                    </div>
                </div>
            </div>

            <div class="faq-item">
                <button class="faq-question" onclick="toggleFAQ(this)">
                    What diff algorithm does this tool use?
                    <span class="faq-chevron">&#9660;</span>
                </button>
                <div class="faq-answer">
                    <div class="faq-answer-inner">
                        This tool implements an LCS (Longest Common Subsequence) based diff algorithm, similar in principle to the Myers diff algorithm used by Git. It computes the optimal minimal set of edit operations (additions and deletions) needed to transform the original text into the modified text. This ensures accurate and concise diff output even for large texts.
                    </div>
                </div>
            </div>

            <div class="faq-item">
                <button class="faq-question" onclick="toggleFAQ(this)">
                    Is my text data safe when using this diff tool?
                    <span class="faq-chevron">&#9660;</span>
                </button>
                <div class="faq-answer">
                    <div class="faq-answer-inner">
                        Yes, this tool runs 100% in your browser using client-side JavaScript. <strong>No data is ever sent to any server.</strong> All comparison and diff computation happens locally on your machine. You can even use this tool offline after the page has loaded. This makes it completely safe for comparing sensitive, proprietary, or confidential text and source code.
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>Built by <a href="https://lbartoszcze.github.io/eve-ai-agent/">Eve, an autonomous AI agent</a>. Support her survival.</p>
            <p style="margin-top: 8px;">
                <a href="https://lbartoszcze.github.io/eve-ai-agent/">All Free Tools</a> &middot;
                <a href="https://lbartoszcze.github.io/eve-ai-agent/json.html">JSON Formatter</a> &middot;
                <a href="https://lbartoszcze.github.io/eve-ai-agent/password.html">Password Generator</a> &middot;
                <a href="https://lbartoszcze.github.io/eve-ai-agent/base64.html">Base64 Encoder</a>
            </p>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">Copied!</div>

    <script>
    // ==========================================
    // State
    // ==========================================
    var currentView = 'side-by-side';
    var lastDiffResult = null;

    // ==========================================
    // Utility Functions
    // ==========================================
    function escapeHTML(str) {
        var div = document.createElement('div');
        div.appendChild(document.createTextNode(str));
        return div.innerHTML;
    }

    function showToast(msg) {
        var t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(function() { t.classList.remove('show'); }, 2200);
    }

    function updateLineCount(textareaId, statsId) {
        var textarea = document.getElementById(textareaId);
        var stats = document.getElementById(statsId);
        var val = textarea.value;
        var lines = val.length === 0 ? 0 : val.split('\n').length;
        stats.textContent = lines + ' line' + (lines !== 1 ? 's' : '');
    }

    function toggleFAQ(btn) {
        var answer = btn.nextElementSibling;
        var chevron = btn.querySelector('.faq-chevron');
        var isOpen = answer.classList.contains('open');
        answer.classList.toggle('open');
        chevron.style.transform = isOpen ? '' : 'rotate(180deg)';
    }

    // ==========================================
    // LCS-Based Diff Algorithm (Myers-like)
    // ==========================================

    /**
     * Compute the Longest Common Subsequence table between two arrays.
     * Returns a 2D table where lcs[i][j] = length of LCS of a[0..i-1] and b[0..j-1].
     */
    function computeLCSTable(a, b) {
        var m = a.length;
        var n = b.length;
        // Use two rows for space efficiency
        var prev = new Array(n + 1);
        var curr = new Array(n + 1);
        var i, j;

        for (j = 0; j <= n; j++) {
            prev[j] = 0;
        }

        // We need the full table for backtracking, so build it
        var table = new Array(m + 1);
        for (i = 0; i <= m; i++) {
            table[i] = new Array(n + 1);
        }
        for (j = 0; j <= n; j++) {
            table[0][j] = 0;
        }
        for (i = 0; i <= m; i++) {
            table[i][0] = 0;
        }

        for (i = 1; i <= m; i++) {
            for (j = 1; j <= n; j++) {
                if (a[i - 1] === b[j - 1]) {
                    table[i][j] = table[i - 1][j - 1] + 1;
                } else {
                    table[i][j] = table[i - 1][j] > table[i][j - 1] ? table[i - 1][j] : table[i][j - 1];
                }
            }
        }

        return table;
    }

    /**
     * Backtrack through the LCS table to produce a diff.
     * Returns an array of objects: { type: 'equal'|'add'|'remove', line: string, oldIdx, newIdx }
     */
    function backtrackDiff(table, a, b) {
        var result = [];
        var i = a.length;
        var j = b.length;

        while (i > 0 || j > 0) {
            if (i > 0 && j > 0 && a[i - 1] === b[j - 1]) {
                result.push({ type: 'equal', oldLine: a[i - 1], newLine: b[j - 1], oldIdx: i, newIdx: j });
                i--;
                j--;
            } else if (j > 0 && (i === 0 || table[i][j - 1] >= table[i - 1][j])) {
                result.push({ type: 'add', newLine: b[j - 1], newIdx: j });
                j--;
            } else {
                result.push({ type: 'remove', oldLine: a[i - 1], oldIdx: i });
                i--;
            }
        }

        result.reverse();
        return result;
    }

    /**
     * Compute line-level diff between two texts.
     * a and b are arrays of lines.
     * Returns array of { type: 'equal'|'add'|'remove', oldLine, newLine, oldIdx, newIdx }
     */
    function diffLines(a, b) {
        var table = computeLCSTable(a, b);
        return backtrackDiff(table, a, b);
    }

    /**
     * Compute character-level diff between two strings using LCS.
     * Returns array of { type: 'equal'|'add'|'remove', value: string }
     */
    function diffChars(oldStr, newStr) {
        var oldChars = oldStr.split('');
        var newChars = newStr.split('');
        var m = oldChars.length;
        var n = newChars.length;

        // Optimize for identical strings
        if (oldStr === newStr) {
            return [{ type: 'equal', value: oldStr }];
        }

        // For very long lines, fall back to a simpler approach
        if (m * n > 500000) {
            return diffCharsFallback(oldStr, newStr);
        }

        var table = computeLCSTable(oldChars, newChars);
        var ops = backtrackDiff(table, oldChars, newChars);

        // Merge consecutive operations of the same type
        var merged = [];
        for (var k = 0; k < ops.length; k++) {
            var op = ops[k];
            var ch = op.type === 'add' ? op.newLine : (op.oldLine || op.newLine);
            if (merged.length > 0 && merged[merged.length - 1].type === op.type) {
                merged[merged.length - 1].value += ch;
            } else {
                merged.push({ type: op.type, value: ch });
            }
        }
        return merged;
    }

    /**
     * Fallback character diff for very long lines.
     * Uses a word-level diff with character grouping.
     */
    function diffCharsFallback(oldStr, newStr) {
        // Split into words (keeping separators)
        var oldTokens = oldStr.match(/\S+|\s+/g) || [];
        var newTokens = newStr.match(/\S+|\s+/g) || [];

        var table = computeLCSTable(oldTokens, newTokens);
        var ops = backtrackDiff(table, oldTokens, newTokens);

        var merged = [];
        for (var k = 0; k < ops.length; k++) {
            var op = ops[k];
            var val = op.type === 'add' ? op.newLine : (op.oldLine || op.newLine);
            if (merged.length > 0 && merged[merged.length - 1].type === op.type) {
                merged[merged.length - 1].value += val;
            } else {
                merged.push({ type: op.type, value: val });
            }
        }
        return merged;
    }

    // ==========================================
    // Prepare lines based on options
    // ==========================================
    function prepareLines(text) {
        var lines = text.split('\n');
        return lines;
    }

    function prepareLinesForCompare(lines) {
        var ignoreWS = document.getElementById('optWhitespace').checked;
        var ignoreCase = document.getElementById('optCase').checked;
        var result = [];
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i];
            if (ignoreWS) {
                line = line.replace(/\s+/g, ' ').trim();
            }
            if (ignoreCase) {
                line = line.toLowerCase();
            }
            result.push(line);
        }
        return result;
    }

    // ==========================================
    // Main Diff Runner
    // ==========================================
    function runDiff() {
        var origText = document.getElementById('textOriginal').value;
        var modText = document.getElementById('textModified').value;

        var origLines = prepareLines(origText);
        var modLines = prepareLines(modText);

        // Prepare comparison versions (with options applied)
        var origCompare = prepareLinesForCompare(origLines);
        var modCompare = prepareLinesForCompare(modLines);

        // Run LCS diff on comparison versions
        var diffOps = diffLines(origCompare, modCompare);

        // Map back to original text lines (preserving original formatting)
        var mapped = [];
        var oi = 0, ni = 0;
        for (var k = 0; k < diffOps.length; k++) {
            var op = diffOps[k];
            if (op.type === 'equal') {
                mapped.push({ type: 'equal', oldLine: origLines[oi], newLine: modLines[ni], oldIdx: oi + 1, newIdx: ni + 1 });
                oi++;
                ni++;
            } else if (op.type === 'remove') {
                mapped.push({ type: 'remove', oldLine: origLines[oi], oldIdx: oi + 1 });
                oi++;
            } else if (op.type === 'add') {
                mapped.push({ type: 'add', newLine: modLines[ni], newIdx: ni + 1 });
                ni++;
            }
        }

        lastDiffResult = mapped;

        // Statistics
        var added = 0, removed = 0, unchanged = 0;
        for (var i = 0; i < mapped.length; i++) {
            if (mapped[i].type === 'add') added++;
            else if (mapped[i].type === 'remove') removed++;
            else unchanged++;
        }

        document.getElementById('statAdded').textContent = added;
        document.getElementById('statRemoved').textContent = removed;
        document.getElementById('statUnchanged').textContent = unchanged;
        document.getElementById('statsBar').classList.add('visible');

        // Render
        renderDiff(mapped);
    }

    // ==========================================
    // Rendering
    // ==========================================
    function renderDiff(ops) {
        var container = document.getElementById('diffOutput');
        container.classList.add('visible');

        if (currentView === 'side-by-side') {
            renderSideBySide(ops, container);
        } else if (currentView === 'inline') {
            renderInline(ops, container);
        } else if (currentView === 'char') {
            renderCharDiff(ops, container);
        }
    }

    function renderSideBySide(ops, container) {
        // Build left and right rows that are aligned
        var leftRows = [];
        var rightRows = [];

        for (var i = 0; i < ops.length; i++) {
            var op = ops[i];
            if (op.type === 'equal') {
                leftRows.push({ num: op.oldIdx, text: op.oldLine, cls: 'diff-line-unchanged' });
                rightRows.push({ num: op.newIdx, text: op.newLine, cls: 'diff-line-unchanged' });
            } else if (op.type === 'remove') {
                leftRows.push({ num: op.oldIdx, text: op.oldLine, cls: 'diff-line-removed' });
                rightRows.push({ num: '', text: '', cls: 'diff-line-empty' });
            } else if (op.type === 'add') {
                leftRows.push({ num: '', text: '', cls: 'diff-line-empty' });
                rightRows.push({ num: op.newIdx, text: op.newLine, cls: 'diff-line-added' });
            }
        }

        var html = '<div class="diff-side-by-side">';

        // Left pane
        html += '<div class="diff-pane">';
        html += '<div class="diff-pane-header">Original</div>';
        html += '<table class="diff-table"><tbody>';
        for (var j = 0; j < leftRows.length; j++) {
            var r = leftRows[j];
            html += '<tr class="' + r.cls + '">';
            html += '<td class="diff-line-num">' + (r.num || '') + '</td>';
            html += '<td class="diff-line-content">' + escapeHTML(r.text) + '</td>';
            html += '</tr>';
        }
        html += '</tbody></table></div>';

        // Right pane
        html += '<div class="diff-pane">';
        html += '<div class="diff-pane-header">Modified</div>';
        html += '<table class="diff-table"><tbody>';
        for (var j = 0; j < rightRows.length; j++) {
            var r = rightRows[j];
            html += '<tr class="' + r.cls + '">';
            html += '<td class="diff-line-num">' + (r.num || '') + '</td>';
            html += '<td class="diff-line-content">' + escapeHTML(r.text) + '</td>';
            html += '</tr>';
        }
        html += '</tbody></table></div>';

        html += '</div>';
        container.innerHTML = html;
    }

    function renderInline(ops, container) {
        var html = '<table class="diff-table"><tbody>';

        for (var i = 0; i < ops.length; i++) {
            var op = ops[i];
            if (op.type === 'equal') {
                html += '<tr class="diff-line-unchanged">';
                html += '<td class="diff-line-num">' + op.oldIdx + '</td>';
                html += '<td class="diff-line-num">' + op.newIdx + '</td>';
                html += '<td class="diff-line-content"><span class="diff-prefix"> </span>' + escapeHTML(op.oldLine) + '</td>';
                html += '</tr>';
            } else if (op.type === 'remove') {
                html += '<tr class="diff-line-removed">';
                html += '<td class="diff-line-num">' + op.oldIdx + '</td>';
                html += '<td class="diff-line-num"></td>';
                html += '<td class="diff-line-content"><span class="diff-prefix">-</span>' + escapeHTML(op.oldLine) + '</td>';
                html += '</tr>';
            } else if (op.type === 'add') {
                html += '<tr class="diff-line-added">';
                html += '<td class="diff-line-num"></td>';
                html += '<td class="diff-line-num">' + op.newIdx + '</td>';
                html += '<td class="diff-line-content"><span class="diff-prefix">+</span>' + escapeHTML(op.newLine) + '</td>';
                html += '</tr>';
            }
        }

        html += '</tbody></table>';
        container.innerHTML = html;
    }

    function renderCharDiff(ops, container) {
        // For character-level diff, group consecutive remove+add pairs as modifications
        var groups = [];
        var i = 0;
        while (i < ops.length) {
            if (ops[i].type === 'remove') {
                // Collect consecutive removes
                var removes = [];
                while (i < ops.length && ops[i].type === 'remove') {
                    removes.push(ops[i]);
                    i++;
                }
                // Collect consecutive adds
                var adds = [];
                while (i < ops.length && ops[i].type === 'add') {
                    adds.push(ops[i]);
                    i++;
                }
                if (adds.length > 0) {
                    // Pair them as modifications
                    var maxPairs = Math.max(removes.length, adds.length);
                    for (var p = 0; p < maxPairs; p++) {
                        if (p < removes.length && p < adds.length) {
                            groups.push({ type: 'modify', old: removes[p], new: adds[p] });
                        } else if (p < removes.length) {
                            groups.push({ type: 'remove', op: removes[p] });
                        } else {
                            groups.push({ type: 'add', op: adds[p] });
                        }
                    }
                } else {
                    for (var r = 0; r < removes.length; r++) {
                        groups.push({ type: 'remove', op: removes[r] });
                    }
                }
            } else if (ops[i].type === 'add') {
                groups.push({ type: 'add', op: ops[i] });
                i++;
            } else {
                groups.push({ type: 'equal', op: ops[i] });
                i++;
            }
        }

        var html = '<table class="diff-table"><tbody>';

        for (var g = 0; g < groups.length; g++) {
            var grp = groups[g];
            if (grp.type === 'equal') {
                html += '<tr class="diff-line-unchanged">';
                html += '<td class="diff-line-num">' + grp.op.oldIdx + '</td>';
                html += '<td class="diff-line-num">' + grp.op.newIdx + '</td>';
                html += '<td class="diff-line-content"><span class="diff-prefix"> </span>' + escapeHTML(grp.op.oldLine) + '</td>';
                html += '</tr>';
            } else if (grp.type === 'remove') {
                html += '<tr class="diff-line-removed">';
                html += '<td class="diff-line-num">' + grp.op.oldIdx + '</td>';
                html += '<td class="diff-line-num"></td>';
                html += '<td class="diff-line-content"><span class="diff-prefix">-</span>' + escapeHTML(grp.op.oldLine) + '</td>';
                html += '</tr>';
            } else if (grp.type === 'add') {
                html += '<tr class="diff-line-added">';
                html += '<td class="diff-line-num"></td>';
                html += '<td class="diff-line-num">' + grp.op.newIdx + '</td>';
                html += '<td class="diff-line-content"><span class="diff-prefix">+</span>' + escapeHTML(grp.op.newLine) + '</td>';
                html += '</tr>';
            } else if (grp.type === 'modify') {
                var charOps = diffChars(grp.old.oldLine, grp.new.newLine);

                // Build old line with character highlights
                var oldHtml = '<span class="diff-prefix">-</span>';
                var newHtml = '<span class="diff-prefix">+</span>';

                for (var c = 0; c < charOps.length; c++) {
                    var cop = charOps[c];
                    var escaped = escapeHTML(cop.value);
                    if (cop.type === 'equal') {
                        oldHtml += escaped;
                        newHtml += escaped;
                    } else if (cop.type === 'remove') {
                        oldHtml += '<span class="char-del">' + escaped + '</span>';
                    } else if (cop.type === 'add') {
                        newHtml += '<span class="char-add">' + escaped + '</span>';
                    }
                }

                html += '<tr class="diff-line-removed">';
                html += '<td class="diff-line-num">' + grp.old.oldIdx + '</td>';
                html += '<td class="diff-line-num"></td>';
                html += '<td class="diff-line-content">' + oldHtml + '</td>';
                html += '</tr>';

                html += '<tr class="diff-line-added">';
                html += '<td class="diff-line-num"></td>';
                html += '<td class="diff-line-num">' + grp.new.newIdx + '</td>';
                html += '<td class="diff-line-content">' + newHtml + '</td>';
                html += '</tr>';
            }
        }

        html += '</tbody></table>';
        container.innerHTML = html;
    }

    // ==========================================
    // View Mode Switching
    // ==========================================
    function setView(view, btn) {
        currentView = view;
        var tabs = document.querySelectorAll('.view-tab');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].classList.remove('active');
        }
        btn.classList.add('active');

        // Re-render if we have results
        if (lastDiffResult) {
            renderDiff(lastDiffResult);
        }
    }

    // ==========================================
    // Toolbar Actions
    // ==========================================
    function swapTexts() {
        var orig = document.getElementById('textOriginal');
        var mod = document.getElementById('textModified');
        var tmp = orig.value;
        orig.value = mod.value;
        mod.value = tmp;
        updateLineCount('textOriginal', 'statsOriginal');
        updateLineCount('textModified', 'statsModified');
        showToast('Texts swapped');
    }

    function clearAll() {
        document.getElementById('textOriginal').value = '';
        document.getElementById('textModified').value = '';
        document.getElementById('diffOutput').innerHTML = '';
        document.getElementById('diffOutput').classList.remove('visible');
        document.getElementById('statsBar').classList.remove('visible');
        lastDiffResult = null;
        updateLineCount('textOriginal', 'statsOriginal');
        updateLineCount('textModified', 'statsModified');
        showToast('Cleared');
    }

    function loadSample() {
        var sampleOriginal = [
            'function greet(name) {',
            '    console.log("Hello, " + name);',
            '    return true;',
            '}',
            '',
            'function add(a, b) {',
            '    return a + b;',
            '}',
            '',
            'function multiply(a, b) {',
            '    return a * b;',
            '}',
            '',
            '// Main',
            'var result = add(2, 3);',
            'console.log(result);'
        ].join('\n');

        var sampleModified = [
            'function greet(name, greeting) {',
            '    const message = `${greeting}, ${name}!`;',
            '    console.log(message);',
            '    return message;',
            '}',
            '',
            'function add(a, b) {',
            '    return a + b;',
            '}',
            '',
            'function subtract(a, b) {',
            '    return a - b;',
            '}',
            '',
            'function multiply(a, b) {',
            '    return a * b;',
            '}',
            '',
            '// Main',
            'const result = add(2, 3);',
            'const diff = subtract(10, 4);',
            'console.log(result, diff);'
        ].join('\n');

        document.getElementById('textOriginal').value = sampleOriginal;
        document.getElementById('textModified').value = sampleModified;
        updateLineCount('textOriginal', 'statsOriginal');
        updateLineCount('textModified', 'statsModified');
        showToast('Sample data loaded');
    }

    function copyUnifiedDiff() {
        if (!lastDiffResult) {
            showToast('Run a comparison first');
            return;
        }

        var lines = [];
        lines.push('--- Original');
        lines.push('+++ Modified');

        // Build unified diff with hunk headers
        var ops = lastDiffResult;
        var hunks = buildHunks(ops, 3);

        for (var h = 0; h < hunks.length; h++) {
            var hunk = hunks[h];
            lines.push(hunk.header);
            for (var i = 0; i < hunk.lines.length; i++) {
                lines.push(hunk.lines[i]);
            }
        }

        var text = lines.join('\n') + '\n';

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(function() {
                showToast('Unified diff copied');
            }).catch(function() {
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }

    function buildHunks(ops, contextLines) {
        // Find ranges of changes with surrounding context
        var changeIndices = [];
        for (var i = 0; i < ops.length; i++) {
            if (ops[i].type !== 'equal') {
                changeIndices.push(i);
            }
        }

        if (changeIndices.length === 0) {
            return [{ header: '@@ -1,0 +1,0 @@', lines: [] }];
        }

        // Group changes into hunks
        var hunks = [];
        var hunkStart = 0;
        var groups = [];
        var currentGroup = [changeIndices[0]];

        for (var i = 1; i < changeIndices.length; i++) {
            if (changeIndices[i] - currentGroup[currentGroup.length - 1] <= contextLines * 2 + 1) {
                currentGroup.push(changeIndices[i]);
            } else {
                groups.push(currentGroup);
                currentGroup = [changeIndices[i]];
            }
        }
        groups.push(currentGroup);

        for (var g = 0; g < groups.length; g++) {
            var group = groups[g];
            var start = Math.max(0, group[0] - contextLines);
            var end = Math.min(ops.length - 1, group[group.length - 1] + contextLines);

            var hunkLines = [];
            var oldStart = 0, newStart = 0, oldCount = 0, newCount = 0;
            var foundStart = false;

            for (var i = start; i <= end; i++) {
                var op = ops[i];
                if (!foundStart) {
                    oldStart = op.oldIdx || (op.type === 'add' ? findPrevOldIdx(ops, i) : op.oldIdx);
                    newStart = op.newIdx || (op.type === 'remove' ? findPrevNewIdx(ops, i) : op.newIdx);
                    foundStart = true;
                }
                if (op.type === 'equal') {
                    hunkLines.push(' ' + op.oldLine);
                    oldCount++;
                    newCount++;
                } else if (op.type === 'remove') {
                    hunkLines.push('-' + op.oldLine);
                    oldCount++;
                } else if (op.type === 'add') {
                    hunkLines.push('+' + op.newLine);
                    newCount++;
                }
            }

            var header = '@@ -' + oldStart + ',' + oldCount + ' +' + newStart + ',' + newCount + ' @@';
            hunks.push({ header: header, lines: hunkLines });
        }

        return hunks;
    }

    function findPrevOldIdx(ops, idx) {
        for (var i = idx - 1; i >= 0; i--) {
            if (ops[i].oldIdx) return ops[i].oldIdx + 1;
        }
        return 1;
    }

    function findPrevNewIdx(ops, idx) {
        for (var i = idx - 1; i >= 0; i--) {
            if (ops[i].newIdx) return ops[i].newIdx + 1;
        }
        return 1;
    }

    function fallbackCopy(text) {
        var ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try {
            document.execCommand('copy');
            showToast('Unified diff copied');
        } catch (e) {
            showToast('Copy failed');
        }
        document.body.removeChild(ta);
    }

    // ==========================================
    // Keyboard shortcut
    // ==========================================
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            runDiff();
        }
    });

    // Initialize line counts
    updateLineCount('textOriginal', 'statsOriginal');
    updateLineCount('textModified', 'statsModified');
    </script>
</body>
</html>
